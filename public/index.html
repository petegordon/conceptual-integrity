<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>The HTML5 Herald</title>
  <meta name="description" content="CRUD Generated HTML">
  <meta name="author" content="CRUD Generated HTML">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
<style>
body {
  margin: 0px;
}

  #table {
    width:100%;
  }
  thead, tbody {
  /*  display: block; */
  }
  tbody {
    height: 100px;       /* Just for the demo          */
    overflow-y: scroll;    /* Trigger vertical scroll    */
    overflow-x: hidden;  /* Hide the horizontal scroll */
  }
  caption {
    text-align:left;
    background-color:#82a1fb;
  }
  thead th {
    background-color:#d9dff3;
  }
	.cell, thead tr, caption{
		padding: 6px;
	}

  #table .row:nth-child(2n) {
    background-color:#f7f79a;
  }
  #table .row:nth-child(2n+1) {
    background-color:#b6ffb6;
  }
  #loading {
    display:none;
    background-color:blue;
  }
  #loading div {
/*
    width: 15px;
    height: 71px;
    position: absolute;
    top: -18px;
    left: 7px;
*/
    width: 40px;
    height: 40px;
    position: absolute;
    top: -4px;
    left: -4px;

  }
</style>
<!--
HOW AM I GOING TO USE THE JAVASCRIPT ON THE CLIENT????

Thinking about generating the constructor in its own file ex. MyObject_Client.  Sounds like Meteor doesn't it.
I'm not certain as of yet.  So, I'm going to ignore it for now.  Will come back to Prototype/Constructor in the UI.


  <script src='desire/MyObject.js'></script>
  <script src='desire/MyDesire.js'></script>
  <script src='desire/ObjectDesire.js'></script>
-->


  <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->


  <script>

  var currentMaxRecord = 0;
  var totalMaxRecord = 0;
  var numOfRecordsToGet = 2;

  $(document).ready(function() {



//    var win = $(window);
/*
    var scrolltop=$('#scrollbox').attr('scrollTop');
    var scrollheight=$('#scrollbox').attr('scrollHeight');
    var windowheight=$('#scrollbox').attr('clientHeight');
    var scrolloffset=20;
    if(scrolltop>=(scrollheight-(windowheight+scrolloffset)))
    {
*/

  });



    function saveMyObject(json){
      var submitJSON = (json)?json:{"isSomething":"something"};
      console.log(submitJSON);
      $.ajax({
        type: 'POST',
        url: '/save/MyObject',
        data: JSON.stringify(submitJSON), // or JSON.stringify ({name: 'jonas'}),
        success: function(data) { console.log(data); },
        contentType: "application/json",
        dataType: 'json'
      });

    }

    function getObjects(table, page, displayCount, callback){
      $.ajax({
        type: 'GET',
        url: '/pageObjects/'+table+'/'+page+'/'+displayCount,
        success: function(data) {
/**
SEE ABOVE HOW TO DO Prototype/Constructor on Client/FrontEnd
          for(var i=0; i<data.result.length; i++){
            data.result[i].__proto__ = eval('MyObject'+'.prootype');
          }
**/
          console.log(data);
          if(callback){
            callback(data);
          }
        },
        dataType: 'json'
      });
    }

    function createTable(tableName){
      getObjects(tableName, 1, 10, function(paging){
        //build table header caption
        $('<caption/>', {
            id: paging.table+'-table-header-caption',
            class: 'caption'
        }).prependTo('#table');
        $('#'+paging.table+'-table-header-caption').append($('<span/>', {style:'left:20px;position:relative',text:tableName}))
        //add loading icon before caption Entity name.
        var loading = $('#loading.template');
        loading.removeClass('template');
        $('#'+paging.table+'-table-header-caption').append(loading);

        //build header row
        $('<thead/>').appendTo('#table');
        $('<tr/>', {
            id: paging.table+'-table-header-row',
            class: 'row'
        }).appendTo('thead');
        for(property in paging.result[0]){
            $('<th/>', {
                class: 'header-cell',
                text: property
            }).appendTo('#'+paging.table+'-table-header-row');
        }

        $('<tbody/>').appendTo('#table');
        // Each time the user scrolls
        $('#table tbody').on('scroll', function() {
    //      console.log('test')
          var el = $('#table tbody').get(0);
//          console.log('document height:'+$(document).height()+' window height:'+$('#table tbody').height()+' window scroll top:'+$('#table tbody').scrollTop() )
          var scrolltop=el.scrollTop;
          var scrollheight=el.scrollHeight;
          var windowheight=el.clientHeight;
//          console.log('scroll top:'+scrolltop+' scroll height:'+scrollheight+' window height:'+windowheight);
          // End of the document reached?
          if ((scrollheight - (windowheight + scrolltop)) < 5){

            if(currentMaxRecord <= totalMaxRecord && !$('#loading').is(":visible")){
              $('#loading').show();
              getObjects('MyObject', currentMaxRecord, (currentMaxRecord+numOfRecordsToGet), function(paging){
                buildRows(paging);
                $('#loading').hide();
              });
            }

          }
        });

        buildRows(paging);

/*
TODO::Let's do paging by scrolling!!!!! instead of this!!!!

        //build table caption
        $('<div/>', {
            id: paging.table+'-table-footer-caption',
            class: 'caption',
            text: 'PAGIN INFO GOES HERE'
        }).appendTo('#outerTable');
*/

      });
    }
    function buildRows(paging){
      currentMaxRecord = paging.end;
      totalMaxRecord = paging.total;
      //build rows
      for(var i=0; i<paging.result.length; i++){
        $('<tr/>', {
            id: paging.table+'-table-row-'+paging.result[i].id,
            class: 'row'
        }).appendTo('#table tbody');
        //build cells in row
        for(property in paging.result[i]){
            $('<td/>', {
                class: 'cell',
                text: paging.result[i][property]
            }).appendTo('#'+paging.table+'-table-row-'+paging.result[i].id);
        }
      }
    }
  </script>
</head>

<body>

  <span id="loading" class="template">
  <style type='text/css'>
  @-webkit-keyframes uil-default-anim {
    0% {
      opacity: 1
    }
    100% {
      opacity: 0
    }
  }

  @keyframes uil-default-anim {
    0% {
      opacity: 1
    }
    100% {
      opacity: 0
    }
  }

  .uil-default-css>div:nth-of-type(1) {
    -webkit-animation: uil-default-anim .5s linear infinite;
    animation: uil-default-anim .5s linear infinite;
    -webkit-animation-delay: -0.25s;
    animation-delay: -0.25s;
  }
  .uil-default-css>div:nth-of-type(2) {
    -webkit-animation: uil-default-anim .5s linear infinite;
    animation: uil-default-anim .5s linear infinite;
    -webkit-animation-delay: -0.20833333333333334s;
    animation-delay: -0.20833333333333334s;
  }
  .uil-default-css>div:nth-of-type(3) {
    -webkit-animation: uil-default-anim .5s linear infinite;
    animation: uil-default-anim .5s linear infinite;
    -webkit-animation-delay: -0.16666666666666669s;
    animation-delay: -0.16666666666666669s;
  }
  .uil-default-css>div:nth-of-type(4) {
    -webkit-animation: uil-default-anim .5s linear infinite;
    animation: uil-default-anim .5s linear infinite;
    -webkit-animation-delay: -0.125s;
    animation-delay: -0.125s;
  }
  .uil-default-css>div:nth-of-type(5) {
    -webkit-animation: uil-default-anim .5s linear infinite;
    animation: uil-default-anim .5s linear infinite;
    -webkit-animation-delay: -0.08333333333333334s;
    animation-delay: -0.08333333333333334s;
  }
  .uil-default-css>div:nth-of-type(6) {
    -webkit-animation: uil-default-anim .5s linear infinite;
    animation: uil-default-anim .5s linear infinite;
    -webkit-animation-delay: -0.04166666666666666s;
    animation-delay: -0.04166666666666666s;
  }
  .uil-default-css>div:nth-of-type(7) {
    -webkit-animation: uil-default-anim .5s linear infinite;
    animation: uil-default-anim .5s linear infinite;
    -webkit-animation-delay: 0s;
    animation-delay: 0s;
  }
  .uil-default-css>div:nth-of-type(8) {
    -webkit-animation: uil-default-anim .5s linear infinite;
    animation: uil-default-anim .5s linear infinite;
    -webkit-animation-delay: 0.041666666666666685s;
    animation-delay: 0.041666666666666685s;
  }
  .uil-default-css>div:nth-of-type(9) {
    -webkit-animation: uil-default-anim .5s linear infinite;
    animation: uil-default-anim .5s linear infinite;
    -webkit-animation-delay: 0.08333333333333331s;
    animation-delay: 0.08333333333333331s;
  }
  .uil-default-css>div:nth-of-type(10) {
    -webkit-animation: uil-default-anim .5s linear infinite;
    animation: uil-default-anim .5s linear infinite;
    -webkit-animation-delay: 0.125s;
    animation-delay: 0.125s;
  }
  .uil-default-css>div:nth-of-type(11) {
    -webkit-animation: uil-default-anim .5s linear infinite;
    animation: uil-default-anim .5s linear infinite;
    -webkit-animation-delay: 0.16666666666666669s;
    animation-delay: 0.16666666666666669s;
  }
  .uil-default-css>div:nth-of-type(12) {
    -webkit-animation: uil-default-anim .5s linear infinite;
    animation: uil-default-anim .5s linear infinite;
    -webkit-animation-delay: 0.20833333333333331s;
    animation-delay: 0.20833333333333331s;
  }

  .loading-anim div {
    top:0px;
    left:0px;
    width:40px;
    height:60px;
    background:#ffffff;
    border-radius:20px;
    position:absolute;
  }
</style>
    <div class='loading-anim uil-default-css' style='transform:scale(0.1);'>
  <div style='-webkit-transform:rotate(0deg) translate(0,-48px);transform:rotate(0deg) translate(0,-48px);'></div>
  <div style='-webkit-transform:rotate(30deg) translate(0,-48px);transform:rotate(30deg) translate(0,-48px);'></div>
  <div style='-webkit-transform:rotate(60deg) translate(0,-48px);transform:rotate(60deg) translate(0,-48px);'></div>
  <div style='-webkit-transform:rotate(90deg) translate(0,-48px);transform:rotate(90deg) translate(0,-48px);'></div>
  <div style='-webkit-transform:rotate(120deg) translate(0,-48px);transform:rotate(120deg) translate(0,-48px);'></div>
  <div style='-webkit-transform:rotate(150deg) translate(0,-48px);transform:rotate(150deg) translate(0,-48px);'></div>
  <div style='-webkit-transform:rotate(180deg) translate(0,-48px);transform:rotate(180deg) translate(0,-48px);'></div>
  <div style='-webkit-transform:rotate(210deg) translate(0,-48px);transform:rotate(210deg) translate(0,-48px);'></div>
  <div style='-webkit-transform:rotate(240deg) translate(0,-48px);transform:rotate(240deg) translate(0,-48px);'></div>
  <div style='-webkit-transform:rotate(270deg) translate(0,-48px);transform:rotate(270deg) translate(0,-48px);'></div>
  <div style='-webkit-transform:rotate(300deg) translate(0,-48px);transform:rotate(300deg) translate(0,-48px);'></div>
  <div style='-webkit-transform:rotate(330deg) translate(0,-48px);transform:rotate(330deg) translate(0,-48px);'></div>
</div>
  </span>

<table id="table"></table>



</body>
</html>
